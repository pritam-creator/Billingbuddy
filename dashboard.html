<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Surjya Bakery</title>

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
}

body{
  background:#f2f3f7;
  padding-bottom:110px;
}

/* HEADER */
.header{
  background:linear-gradient(135deg,#ff9966,#ff5e62);
  color:white;
  padding:20px;
  text-align:center;
  position:sticky;
  top:0;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}

.logo{
  width:70px;
  margin-bottom:8px;
}

.sub-info{
  font-size:13px;
  opacity:0.9;
  margin-bottom:10px;
}

.logout-btn{
  background:white;
  color:#ff5e62;
  border:none;
  padding:8px 18px;
  border-radius:20px;
  font-weight:600;
  cursor:pointer;
}

.logout-btn:active{
  transform:scale(0.95);
}

/* STATS */
.stats{
  display:flex;
  justify-content:space-between;
  gap:10px;
  padding:15px 20px;
}

.stat-card{
  flex:1;
  background:white;
  padding:15px;
  border-radius:15px;
  text-align:center;
  box-shadow:0 6px 15px rgba(0,0,0,0.05);
  font-size:14px;
}

.stat-card h3{
  color:#ff5e62;
  margin-top:5px;
}

/* GRID */
.container{
  padding:10px 20px 20px;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:15px;
}

.card{
  background:white;
  padding:25px 15px;
  border-radius:18px;
  text-align:center;
  box-shadow:0 6px 15px rgba(0,0,0,0.05);
  cursor:pointer;
  font-size:16px;
  font-weight:600;
}

.card:active{
  transform:scale(0.96);
}

/* BOTTOM NAV */
.bottom-nav{
  position:fixed;
  bottom:0;
  width:100%;
  background:white;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
  box-shadow:0 -2px 8px rgba(0,0,0,0.1);
}

.bottom-nav div{
  text-align:center;
  font-size:12px;
  color:#888;
  cursor:pointer;
}

.bottom-nav .active{
  color:#ff5e62;
  font-weight:600;
}
</style>
</head>

<body>

<div class="header">
  <img src="https://raw.githubusercontent.com/pritam-creator/billingbuddy-assets/refs/heads/main/Untitled.png" class="logo">
  <h2>üçû Surjya Bakery</h2>
  <div class="sub-info" id="greeting"></div>
  <button class="logout-btn" id="logoutBtn">Logout</button>
</div>

<div class="stats">
  <div class="stat-card">
    Today Sales
    <h3 id="todaySales">‚Çπ0</h3>
  </div>
  <div class="stat-card">
    Orders
    <h3 id="ordersCount">0</h3>
  </div>
  <div class="stat-card">
    Clients
    <h3 id="clientsCount">0</h3>
  </div>
</div>

<div class="container">
  <div class="grid">
    <div class="card" data-page="items.html">üì¶ Items</div>
    <div class="card" data-page="invoice.html">üßæ Invoice</div>
    <div class="card" data-page="clients.html">üë• Clients</div>
    <div class="card" data-page="inventory.html">üè™ Inventory</div>
    <div class="card" data-page="orders.html">üìã Orders</div>
    <div class="card" data-page="records.html">üìä Records</div>
  </div>
</div>

<div class="bottom-nav">
  <div class="active" data-page="dashboard.html">üè†<br>Home</div>
  <div data-page="clients.html">üë•<br>Clients</div>
  <div data-page="inventory.html">üì¶<br>Inventory</div>
  <div data-page="orders.html">üßæ<br>Orders</div>
  <div data-page="records.html">üìä<br>Records</div>
</div>

<script type="module">
/* Logout (100% Working) */
document.getElementById("logoutBtn")
.addEventListener("click",()=>{
  if(confirm("Are you sure you want to logout?")){
    sessionStorage.removeItem("loggedIn");
    window.location.replace("index.html");
  }
});

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, query, where }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* LOGIN CHECK */
if (sessionStorage.getItem("loggedIn") !== "true") {
  window.location.replace("index.html");
}

/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyBjETFSgZsMDw1JRI0fIcUNMCMOHxBMaLA",
  authDomain: "billingbuddy-551f9.firebaseapp.com",
  projectId: "billingbuddy-551f9",
  storageBucket: "billingbuddy-551f9.firebasestorage.app",
  messagingSenderId: "287026017084",
  appId: "1:287026017084:web:aae879570ad706e5a2a439"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* Greeting */
function updateGreeting(){
  const now = new Date();
  const hour = now.getHours();
  let greet = "Good Evening";

  if(hour < 12) greet = "Good Morning ‚òÄÔ∏è";
  else if(hour < 18) greet = "Good Afternoon üå§Ô∏è";

  document.getElementById("greeting").innerText =
    greet + " | " +
    now.toLocaleDateString() + " | " +
    now.toLocaleTimeString();
}

setInterval(updateGreeting,1000);
updateGreeting();

/* Load Stats */
async function loadDashboard(){

  try{
    const today = new Date().toISOString().split("T")[0];

    const salesQuery = query(
      collection(db,"sales"),
      where("date","==",today)
    );

    const salesSnap = await getDocs(salesQuery);

    let total = 0;
    salesSnap.forEach(doc=>{
      total += Number(doc.data().total || 0);
    });

    document.getElementById("todaySales").innerText = "‚Çπ" + total;

    const ordersSnap = await getDocs(collection(db,"orders"));
    document.getElementById("ordersCount").innerText = ordersSnap.size;

    const clientsSnap = await getDocs(collection(db,"clients"));
    document.getElementById("clientsCount").innerText = clientsSnap.size;

  }catch(err){
    console.error("Dashboard Load Error:", err);
  }
}

loadDashboard();

/* Navigation (All Cards + Bottom Nav) */
document.querySelectorAll("[data-page]").forEach(el=>{
  el.addEventListener("click",()=>{
    window.location.href = el.getAttribute("data-page");
  });
});


</script>

</body>
</html>