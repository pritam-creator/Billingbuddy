<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Items - Surjya Bakery</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif;}
body{background:#f4f6fb;padding-bottom:120px;}

.header{
background:linear-gradient(135deg,#ff9966,#ff5e62);
color:white;
padding:18px;
font-size:20px;
font-weight:600;
display:flex;
justify-content:space-between;
align-items:center;
}

.header button{
background:white;
color:#ff5e62;
border:none;
padding:6px 12px;
border-radius:20px;
font-size:12px;
font-weight:600;
cursor:pointer;
}

.form{
background:white;
margin:15px;
padding:15px;
border-radius:16px;
box-shadow:0 4px 12px rgba(0,0,0,0.05);
}

.form input{
width:100%;
padding:10px;
margin-bottom:10px;
border-radius:8px;
border:1px solid #ddd;
font-size:14px;
}

.add-btn{
width:100%;
padding:10px;
background:linear-gradient(135deg,#ff9966,#ff5e62);
color:white;
border:none;
border-radius:10px;
font-weight:600;
cursor:pointer;
}

.item{
background:white;
margin:15px;
padding:15px;
border-radius:16px;
box-shadow:0 4px 12px rgba(0,0,0,0.05);
}

.actions{
margin-top:10px;
display:flex;
gap:8px;
}

.btn{
flex:1;
padding:8px;
border:none;
border-radius:8px;
font-size:13px;
font-weight:600;
color:white;
cursor:pointer;
}

.edit{background:#f1c40f;}
.delete{background:#e74c3c;}
.cart{background:#2ecc71;}

.floating-cart{
position:fixed;
bottom:80px;
right:20px;
background:linear-gradient(135deg,#ff9966,#ff5e62);
color:white;
padding:16px;
border-radius:50%;
font-size:18px;
box-shadow:0 6px 15px rgba(0,0,0,0.2);
cursor:pointer;
}

.cart-count{
position:absolute;
top:-5px;
right:-5px;
background:#2ecc71;
color:white;
font-size:12px;
width:20px;
height:20px;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
}
</style>
</head>

<body>

<div class="header">
<span>ðŸ“¦ Items</span>
<button onclick="window.location.href='dashboard.html'">Back</button>
</div>

<div class="form">
<input id="name" placeholder="Item Name">
<input id="price" type="number" placeholder="Price">
<button class="add-btn" onclick="addItem()">Add Item</button>
</div>

<div id="list"></div>

<div class="floating-cart" onclick="window.location.href='cart.html'">
ðŸ›’
<div class="cart-count" id="cartCount">0</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, where } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBjETFSgZsMDw1JRI0fIcUNMCMOHxBMaLA",
  authDomain: "billingbuddy-551f9.firebaseapp.com",
  projectId: "billingbuddy-551f9",
  storageBucket: "billingbuddy-551f9.firebasestorage.app",
  messagingSenderId: "287026017084",
  appId: "1:287026017084:web:aae879570ad706e5a2a439"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* AUTH CHECK */
onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.replace("index.html");
  } else {
    loadItems();
    updateCartCount();
  }
});

/* ADD ITEM */
window.addItem = async function(){
  const user = auth.currentUser;
  if(!user) return;

  let name = document.getElementById("name").value.trim();
  let price = document.getElementById("price").value;

  if(!name || !price){
    alert("Fill all fields");
    return;
  }

  await addDoc(collection(db,"items"),{
    name: name,
    price: Number(price),
    ownerId: user.uid
  });

  document.getElementById("name").value="";
  document.getElementById("price").value="";
  loadItems();
}

/* LOAD ONLY USER ITEMS */
async function loadItems(){
  const user = auth.currentUser;
  const list = document.getElementById("list");
  list.innerHTML="";

  const q = query(collection(db,"items"), where("ownerId","==",user.uid));
  const snapshot = await getDocs(q);

  snapshot.forEach((docSnap)=>{
    const data = docSnap.data();

    const div = document.createElement("div");
    div.className="item";
    div.innerHTML = `
      <div><b>${data.name}</b><br>â‚¹ ${data.price}</div>
      <div class="actions">
        <button class="btn edit">Edit</button>
        <button class="btn delete">Delete</button>
        <button class="btn cart">Add</button>
      </div>
    `;

    const btns = div.querySelectorAll("button");

    btns[0].onclick = () => editItem(docSnap.id,data.name,data.price);
    btns[1].onclick = () => deleteItem(docSnap.id);
    btns[2].onclick = () => addToCart(data.name,data.price);

    list.appendChild(div);
  });
}

/* DELETE */
async function deleteItem(id){
  if(confirm("Delete item?")){
    await deleteDoc(doc(db,"items",id));
    loadItems();
  }
}

/* EDIT */
async function editItem(id,name,price){
  let newName = prompt("Edit name:",name);
  let newPrice = prompt("Edit price:",price);

  if(newName && newPrice){
    await updateDoc(doc(db,"items",id),{
      name:newName,
      price:Number(newPrice)
    });
    loadItems();
  }
}

/* ADD TO CART */
async function addToCart(name,price){
  const user = auth.currentUser;
  if(!user) return;

  await addDoc(collection(db,"cart"),{
    name:name,
    price:Number(price),
    userId:user.uid
  });

  updateCartCount();
}

/* CART COUNT */
async function updateCartCount(){
  const user = auth.currentUser;
  const q = query(collection(db,"cart"), where("userId","==",user.uid));
  const snapshot = await getDocs(q);
  document.getElementById("cartCount").innerText = snapshot.size;
}

</script>

</body>
</html>